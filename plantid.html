<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>plant identification</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
</body>
</html>

<body>
  <main class="plant-id-main">
    <h2 class="header-plant-id">Identify Your Plant</h2>
    <form>
      <div class="file-choose-container">
        <label for="input-plant-id">Upload a photo</label>
            <input type="file" id="input-plant-id" class="custom-file-input" multiple />
      </div>
      <button type="button" class="plant-id-button">OK</button>
    </form>
    <h2 class="common-name-title"></h2>
    <div class="common-name"></div>
    <h2 class="scientific-name-title"></h2>
    <div class="plant-name"></div>
    <div class="plant-picture"></div>
    
    <script type="text/javascript">
    
    document.querySelector('button').onclick = function sendIdentification() {
      const files = [...document.querySelector('input[type=file]').files];
      const promises = files.map((file) => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (event) => {
              const res = event.target.result;
              console.log(res);
              resolve(res);
            }
            reader.readAsDataURL(file)
        })
    
      })
    
      Promise.all(promises).then((base64files) => {
        console.log(base64files)
    
        const data = {
          api_key: "xFCXUGwXmsC3mUrFGjsu6CwofUABXyIiu9juLeAAVFbQhUv4Ml",
          images: base64files,
          // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
          modifiers: ["crops_fast", "similar_images"],
          plant_language: "en",
          // plant details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Plant-details
          plant_details: ["common_names",
                          "url",
                          "name_authority",
                          "wiki_description",
                          "taxonomy",
                          "synonyms"],
    
                        };
    
        fetch('https://api.plant.id/v2/identify', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
    
          let arr = data.suggestions;
          for(let i = 0; i < arr.length ; i++ ){
            // console.log(data.suggestions[i].plant_name);
            document.querySelector('.scientific-name-title').innerHTML = "Scientific Name:";
            document.querySelector('.plant-name').innerHTML += data.suggestions[i].plant_name;
    
            for(let q = 0; q < data.suggestions[i].plant_details.common_names.length; q++){
          document.querySelector('.common-name-title').innerHTML = "Common Name:";
          document.querySelector('.common-name').innerHTML += data.suggestions[i].plant_details.common_names[q];
          }
    
          for(let j = 0; j < data.suggestions[i].similar_images.length; j++){
          let image = data.suggestions[i].similar_images[j].url ;
          document.querySelector('.plant-picture').innerHTML += `<img src="${image}" alt="" >`;
    
          }
          }
          // document.querySelector('img').src = "data.suggestions[0].similar_images[0].url";
        })
        .catch((error) => {
          console.error('Error:', error);
        });
      })
    
      
    };
    
    </script>
  </main>
</body>

</html>